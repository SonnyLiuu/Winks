name: Release

on:
  push:
    tags:
      - "v*"
  workflow_dispatch:

permissions:
  contents: write

# ðŸ‘‡ run all shell steps inside WinksUI
defaults:
  run:
    working-directory: WinksUI

jobs:
  windows:
    runs-on: windows-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: "npm"
          cache-dependency-path: WinksUI/package-lock.json

      - name: Install deps
        run: npm ci

      - name: Build (renderer/main)
        run: npm run build

      - name: Package & Publish (electron-builder)
        run: npx electron-builder --win --publish always
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          # Optional signing:
          # CSC_LINK: ${{ secrets.WINDOWS_CERT_PFX }}
          # CSC_KEY_PASSWORD: ${{ secrets.WINDOWS_CERT_PASS }}

  # Uncomment to add Linux builds (no signing required by default)
  # linux:
  #   runs-on: ubuntu-latest
  #   steps:
  #     - uses: actions/checkout@v4
  #       with: { fetch-depth: 0 }
  #     - uses: actions/setup-node@v4
  #       with: { node-version: 20, cache: 'npm' }
  #     - run: npm ci
  #     - run: npm run build
  #     - run: npx electron-builder --linux --publish always
  #       env:
  #         GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

  # macOS builds require signing & (usually) notarization. Add later when ready.
